<!doctype html>
<html>
    <head>
        <title>Web Coding for beginners: Population Graphs</title>
        <meta charset='utf-8'/>
        <link rel="stylesheet" type="text/css" href="./WebCodingForBeginners.html_files/styles.css">
        <script>
            window.onload = function() {
                if (document.querySelector("script[type=\"math/tex; mode=display\"]") !== null) {
                    var mathjax = document.createElement("script");
                    mathjax.src = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML";
                    document.head.appendChild(mathjax);
                }
                if (document.getElementsByTagName("code").length !== 0) {
                    var highlight = document.createElement("script");
                    var highlightcss = document.createElement("link");
                    highlight.src = "http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js";
                    highlightcss.rel = "stylesheet";
                    highlightcss.href = "http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css";
                    highlight.onload = function() {hljs.initHighlighting();};
                    document.head.appendChild(highlight);
                    document.head.appendChild(highlightcss);
                }
            }
        </script>
    </head>
    <body>
        <article>
            <h1 id="web-coding-for-beginners-population-graphs">Web Coding for beginners: Population Graphs</h1>
<p>Welcome to the amazing world of web coding! In this workshop we will build a simple web app that can visualize population graphs for different countries. Let&#39;s look over some general information about the workshop first.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You should have installed Visual Studio Code on your computer. If you have not installed it, please do so now at <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>. Select the <em>Download for Windows</em> if you have a Windows computer. Or your own operating system. Install it with default setup. </p>
<p>Visual Studio Code is a handy code editor. It&#39;s not too heavy but helps in many ways with coding. It for example colours the different kinds of HTML, CSS and Javascript elements in different colours to help you read the code. </p>
<h2 id="pre-work">Pre-work</h2>
<p>You should have completed the pre-work for this workshop:
<em>Read and do the simple exercises in the following materials before the workshop. All materials are by Mozilla. Total time required ~3-5 hours.</em> </p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Introduction_to_HTML/Getting_started">Getting started with HTML</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS/First_steps/What_is_CSS">What is CSS?</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS/First_steps/Getting_started">Getting started with CSS</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/First_steps/What_is_JavaScript">What is JavaScript?</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics">JavaScript basics</a></li></ul>
<h2 id="time-requirement-for-the-workshop">Time requirement for the workshop</h2>
<p>Our initial estimate is that it it possible to build the population graphs app in one working day (8 hours). This assumes no previous programming experience, but does assume that the person starting this workshop has completed the pre-work defined above and is comfortable using a computer and a browser.</p>
<h2 id="goal">Goal</h2>
<p>In this workshop, we are building a web app that can <strong>visualize the population time series</strong> for any country the user selects. Population time series are pretty interesting, they can tell their own stories about the history and present of countries. Some countries population is rapidly growing. Usually those are developing countries. Many western countries&#39; population is stable or slightly declining. That means possible problems in the future as there is usually a larger pension-age population and less people in working age (partly or fully paying the pensioners&#39; pensions!). Unfortunately major devastations like a civil war also show in a population graph as we will later see.  </p>
<p>So the beef of the app would be something like this graph (which shows the population graph of Nigeria):</p>
<p><img src="WebCodingForBeginners.html_files\images\samplegraph.png" alt="Population graph for Nigeria"></p>
<p>We could at this point sketch a simple description of what the app should do:
1) User selects a country
2) User sees the population graph for that country</p>
<p>Simple. Let&#39;s try to keep it that way.</p>
<h2 id="tools">Tools</h2>
<p>So how are we going to build the web app? What will we need? Take a moment to name some of the technologies and things you can recall from the pre-work Mozilla tutorials - or just venture a good guess - before moving on. </p>
<p>Guessed something? Good. Most likely you remembered some of the following:</p>
<ul>
<li><strong>HTML</strong> (Hypertext Markup Language) for creating the structure of the user interface (UI, the page the user sees and can interact with) </li><li><strong>CSS</strong> (Cascading Style Sheets) for defining the style, visual look of the page</li><li><strong>Javascript</strong>, a programming language, for creating the interactivity and logic for the app </li></ul>
<p>Essential tools! With those one can do great things! But there is one - maybe the most essential component - that was not on that list. We can&#39;t just randomly generate some numbers to show as the population of Sweden. Our app is worthless if we do not have the <strong>data</strong> to display.</p>
<p>Enter <strong>World Bank</strong>. Our friends in Washington D.C. provide loans and grants to the governments of poorer countries to make possible and speed up the development of those countries. But they also provide data. Lots of data. And a lot of that data is <strong>open data</strong>, meaning it&#39;s provided free of charge to anyone wanting to use it. Wait a minute: would they happen to have population data on countries all around the world? You guessed it. They do! But as we are coders building an automatic app, it is not enough that the data is open. It also has to be machine-readable. That means a format where we can easily access it and use it for our app. Fortunately it is. Next, let&#39;s take a look at what it looks like.  </p>
<h2 id="data">Data</h2>
<p>World Bank offers the population data through an <strong>API</strong>, an application programming interface. In English, an API means that we can send a message to the World Bank computer system saying <em>Give me the population time series of Finland</em> and the system sends it back to us in a reply message. So it&#39;s like a defined way of talking to the World Bank system.</p>
<p>So how do we actually talk to the World Bank API? Well to get the population time series of Finland, we send a request to the address <a href="https://api.worldbank.org/v2/country/FIN/indicator/SP.POP.TOTL?format=json">https://api.worldbank.org/v2/country/FIN/indicator/SP.POP.TOTL?format=json</a>. Whoa, that looks ugly and complicated! But hey, let&#39;s try it. So, open your browser (e.g. Google Chrome) and copy that address to the address input field and hit enter. Yes, do it now.</p>
<p>You should see a screen like this:</p>
<p><img src="WebCodingForBeginners.html_files\images\api_finland.png" alt="World Bank JSON data"></p>
<p>It looks... well... it looks like a lot of data. But let&#39;s take a closer look. We&#39;ve circled a couple of points of interest in the picture. First, the data says <em>Finland</em>, so it looks like we indeed got back some data about Finland. The Finland marking in fact runs all the way down the page. Second, there&#39;s a list of what looks like year numbers running down the page. And third, next to the year numbers, there&#39;s values. For the circled year (2018), the value is 5518050. A bit over 5,5 million. Yes, that looks like the population of Finland. And these values seem to be associated with the years. So we can be pretty confident that we got what we asked for, a population time series of Finland. Just in a bit clunky format. The format is actually called <strong>JSON</strong> (JavaScript Object Notation). We&#39;ll take a bit closer look at it later.</p>
<p>Take a look and see if you can find what is the earliest year in the time series.</p>
<p>Now of course the API does not offer data on only Finland and only the total population.
If you&#39;re feeling curious, you can see what happens if you exchange the FIN part in the address to ITA? What about if you change the part SP.POP.TOTL to SP.POP.65UP.FE.IN or SP.DYN.LE00.MA.IN? There seems to be a lot of data at our fingertips!</p>
<h2 id="basic-view-with-titles">Basic view with titles</h2>
<p>OK, so we know that we have access to the data we need for our app. Let&#39;s get started with building it. </p>
<p>We&#39;ll start with a minimal HTML file. Download the file at <a href="https://raw.githubusercontent.com/mikkokotola/populationgraphs/5ba3debb035a834d2695b2f0c4feb2c53cbc521d/public/index.html">https://raw.githubusercontent.com/mikkokotola/populationgraphs/5ba3debb035a834d2695b2f0c4feb2c53cbc521d/public/index.html</a></p>
<p>If you open the file in Chrome, it will most likely open in your browser as a page. You can save the file to your own computer by pressing <code>Ctrl + S</code>. Create a folder in a suitable location on your computer. Name your folder e.g. <em>PopulationGraphs</em> and save the file <em>index.html</em> inside that folder.</p>
<p>Now open the file in Visual Studio Code. You can do this by going to the file folder in Resource manager, right-clicking on the file and selecting <em>Open with Code</em>.</p>
<p><img src="WebCodingForBeginners.html_files\images\open_with_vscode.png" alt="Open with code in resource manager"></p>
<p>You should see a screen something like this:</p>
<p><img src="WebCodingForBeginners.html_files\images\starthtml.png" alt="Minimal HTML file in Visual Studio Code"></p>
<p>Great! Now also try opening the file with your browser by double-clicking on it in Resource manager. You should see something like this:</p>
<p><img src="WebCodingForBeginners.html_files\images\startview.png" alt="Initial html document"></p>
<p>It&#39;s pretty much a blank screen! But do notice the title of the page (<em>Title here</em>). And the fact that you were able to open the page with your browser. A browser is the main way to view web pages, so this was an important test: you have just verified that you are able to view the first version of your app as a user! OK, it does not do anything yet, but it works! </p>
<p>Now, modify the <em>index.html</em> file in Visual Studio Code in the following ways (and save the file after the modifications):</p>
<ul>
<li>Change the title to <em>Population graph app</em></li><li>Add an heading (&lt;h1&gt; element) inside the body of the document that says <em>Population graphs</em></li></ul>
<p>H1 heading... I know what it it, but how exactly was it written as code?, you may ask. A very good question! We will now share a secret with you. <em>You don&#39;t need to remember!</em> In fact <em>no coder remembers the exact way to write all code expressions</em>. Not after 1 year, and not after 10 years of professional coding experience. But it has to be written correctly (in professional speak the <em>syntax</em> needs to be correct) for the code to work. So what to do?</p>
<p>Well google it! Open Google and type in <em>H1 heading example</em>. Pick e.g. the result near the top that is from w3schools.com. And there you have it: an example of how to write an h1 heading in HTML.</p>
<p>This might be the most important thing you learn in this workshop. You do not have to remember the exact syntax for code. Of course you will learn and be able to write common things by heart, but if you don&#39;t remember, it&#39;s no problem. Just google it. Everyone does. (And quite soon you will find <em>Stack overflow</em>, a site specializing in sharing discussions around problems coders face - and solutions to them.)</p>
<p>So, you managed to change the title and add a heading. Now reload the file in your browser to verify that your changes are working. This is also important. Do code changes in small steps. Check after the changes that the changes work by reloading the document in your browser.</p>
<p><img src="WebCodingForBeginners.html_files\images\titles.png" alt="Titles inserted"></p>
<h2 id="our-aim-walking-skeleton-mvp">Our aim: Walking skeleton, MVP</h2>
<p>Our aim will be to get a minimal working version of the application as soon as possible. This is almost always the preferred approach to building an application. A minimal version that has all the needed parts is sometimes called the <strong>Walking skeleton</strong>. It has all the body parts but not much flesh around the bones. The reason for this approach is that it&#39;s easier to get the different part to work together if it&#39;s done early on. Once we have all the needed parts and we know they work together, it&#39;s much less risky to add functionality and make the different parts prettier.</p>
<p>Our walking skeleton will have</p>
<ul>
<li>Possibility for the user to input a country</li><li>Fetching the population time series for that country</li><li>Showing the population graph</li></ul>
<p>It will not be pretty, but that&#39;s not important at the walking skeleton phase.</p>
<p>Once our skeleton walks, we will make it prettier. At that point we will pretty much have a <strong>MVP</strong>, a <em>Minimum Viable Product</em>. An MVP is something that we could - and should - give to actual users to try out. It will not be perfect, but giving it to users to try out will give us information about if it does what the user needs it to do. And also about what they would like it to do and how we could improve it.</p>
<h2 id="reading-input-from-the-user">Reading input from the user</h2>
<p>So far we don&#39;t have any of the three parts of the walking skeleton. Let&#39;s get the first one done. Let&#39;s get input from the user on what country she wants to view a population graph for.</p>
<p>We will start simple. We&#39;ve seen that we can fetch data based on a three-letter country code (like FIN). That&#39;s good enough. Let&#39;s offer the user a text field to type in a three letter country code.</p>
<p>Add the following HTML line under the &lt;h1&gt; element in your index.html file:</p>
<pre><code>    &lt;input class=&#39;textinput&#39; placeholder=&#39;Whoa!&#39; type=&#39;text&#39; id=&#39;country&#39; maxlength=&#39;5&#39;/&gt;
</code></pre><p>Save the file and reload the page in your browser. Try inputting text into the field.</p>
<p>Let&#39;s look at the line we just inserted. It it an <em>input</em> element, which is used for getting user input. The input element has many <em>attributes</em>. It has <em>class</em>, which we will use later for making it prettier and an <em>id</em>, a unique identifier for this element which we will use in a moment. The class and id is not doing anything yet. But the <em>placeholder</em> is. And it&#39;s value is a bit funny. Change the value of the placeholder to <code>Country</code> and reload the page in your browser. The type <em>text</em> defines that we want text input and the <em>maxlength</em> limits the amount of characters the user can input. The current value is bit off. Fix it so that the user can only enter 3 characters. </p>
<p>Nice. Let&#39;s also add an instruction text line so that the user can check what the 3-letter codes are if she can&#39;t guess it by heart. So add this line before the input element:</p>
<pre><code>    &lt;p&gt;Enter three letter &lt;a href=&#39;https://en.wikipedia.org/wiki/ISO_3166-1#Current_codes&#39; 
        target=&#39;_blank&#39;&gt;country code&lt;/a&gt;&lt;/p&gt;
</code></pre><p>It&#39;s a paragraph (a &lt;p&gt; element) with some text and a link. The <code>target=&#39;_blank&#39;</code> makes the browser open the linked page in a new tab instead of the current tab when the user clicks it.</p>
<p>Save the file and reload the page in your browser if you haven&#39;t already. From now on we will not say this every time after code changes, but you should <em>always</em> do it after changes to the code. This way you can see right away if your change does not work and fix it right away.</p>
<p>So the user is inputting three letter codes, but nothing is happening. Let&#39;s add a button below the input field that the user can press:</p>
<pre><code>    &lt;p&gt;
        &lt;button class=&#39;button&#39; id=&#39;renderBtn&#39;&gt;Why? Sympaticos.&lt;/button&gt;
    &lt;/p&gt;
</code></pre><p>Notice that the button also has the <em>class</em> and <em>id</em> attributes. The button text is not very informative. Update it to &#39;Render population graph&#39;.</p>
<p>OK, the button is there and can be pressed, but nothing is still happening. The button does not have any default functionality. We have to create it ourselves using Javascript.</p>
<h2 id="first-script-log-it-baby">First script: log it, baby!</h2>
<p>We will make something happen when the button is pressed by adding some <em>script</em> to the document. Let&#39;s add the code first, and then try it and analyze it piece by piece.</p>
<p>Add the following code just before the &lt;/body&gt; tag (at the end of the body of the document):</p>
<pre><code>    &lt;script&gt;
        // Define a function called logCountryCode. This function takes no arguments 
        // (the brackets after the function name are empty). When the function is called, 
        // the two indented lines of code are executed.
        function logCountryCode () {
            // Define a variable called countryCode. Put into it the value that is in the 
            //HTML element with id &#39;country&#39;.
            var countryCode = document.getElementById(&#39;country&#39;).value;
            // Print the value of the variable countryCode into the console.
            console.log(countryCode);
        }

        // Add an event listener to the HTML element with the id &#39;renderBtn&#39;. That&#39;s our 
        // button. When the event &#39;click&#39; happens (when the button is clicked), run the 
        // function &#39;logCountryCode&#39;.
        document.getElementById(&#39;renderBtn&#39;).addEventListener(&#39;click&#39;, logCountryCode);
    &lt;/script&gt;
</code></pre><p>Notice how much easier it it to look at in Visual Studio Code with the colours indicating different types of elements. Now try out our updated app in your browser.</p>
<p>Eeeh. There&#39;s still nothing happening when you press the button. Or is there?</p>
<p>In your browser, hit <code>Ctrl + Shift + I</code>. You should see the <em>developer tools</em> opening up in your browser. Find the tab <em>Console</em> and click it. Now try entering some 3-letter codes and pressing the button. You should see the text you entered appearing in the console window immediately as you push the button. So it seems the code is writing the country codes to the console.</p>
<p><img src="WebCodingForBeginners.html_files\images\console.png" alt="Logging data to console"></p>
<p>Now that you opened the console, try it out a bit more. Type or copy-paste <code>console.log(&#39;Hi there!&#39;)</code> in the console and hit enter. Try also <code>1+8</code>. And  <code>var result = 1+8</code> and then <code>result</code>.</p>
<p>So when you type in Javascript code to the console, the console will execute it. Now type some country code into the input field and run <code>logCountryCode ()</code> in the console. You should see the text you had in the input field printed in the console. You have just <em>called</em> the function logCountryCode from the console. So the console executed the two lines of code inside that function. A <strong>function</strong> is a piece of code that can be reused by calling it several times. You can give a function some input parameters (our function does not have any, the brackets in the function definition are empty). And it always returns some value to the caller. You actually already saw in your console what our function returns: <code>undefined</code>. That&#39;s Javascript and means &#39;nothing&#39;. Our function returns nothing. It currently does the logging and does not need to return any value to the caller.</p>
<p>So what is each line in our code doing? Try reading the code now if you have not yet done so, and see if you understand some of the lines.</p>
<p>You will notice that the code has comment lines, which start with <code>//</code>. Those lines are just comments (they are not really part of the code). They are meant for humans reading the code to clarify what the code is doing. These comments are very long and meant for learning. Usually there are only few comments in code. Code should be self-explanatory thanks to well-named variables and functions. </p>
<p>The comments pretty much translate to English what the code is saying in Javascript. First define a function (a reusable chunk of code) that gets the text that is currently in the input field and prints it in the console. Then attach an event listener to the button and tell the button to call the function when it is clicked.</p>
<p>Now this might have sounded quite complicated to you. No worries. This was a huge leap forward and introduced several very big programming concepts: <em>variables</em>, <em>functions</em>, <em>events</em> and <em>callback functions</em> (that&#39;s what it&#39;s called when you assign the function to the event listener: when the &#39;click&#39; event occurs, call this function). You don&#39;t have to understand every bit of the code fully yet. Focus on grasping on a higher level what each part does.</p>
<p>But hey: We were able to read in input from the user and use it (print it in the console). The first of the three parts of the walking skeleton ready! Good stuff!</p>
<h2 id="keep-it-clean-script-to-a-separate-file">Keep it clean: script to a separate file</h2>
<p>We have written script directly into the HTML file. That works and is fine if you are doing something very small. But best practice is to have the scripts in a separate file. That way they are cleaner to read and edit and easier to reuse. So let&#39;s create a separate file and move our current scripts there.</p>
<p>Create a new file in Visual Studio Code by clicking <em>File</em>-&gt;<em>New File</em> at the top left corner. This creates a new file and opens it. Now click <em>File</em>-&gt;<em>Save As</em>. Then, in the dialog, click the <em>Save as type</em> and select <em>JavaScript(\</em>.js...)<em>. Then modify the file name to be </em>myChart.js<em> and click </em>Save*.</p>
<p>Now copy everything <em>between</em> the <em>&lt;script&gt;</em> and the &lt;/script&gt; tags (but not the script tags) in the <em>index.html</em> to the new <em>myChart.js</em> and save that file.</p>
<p>Then delete the whole script block within <em>index.html</em>. And insert the following line at the end of the <em>head</em> of your <em>index.html</em>:</p>
<pre><code>    &lt;script defer src=&#39;./myChart.js&#39;&gt;&lt;/script&gt;
</code></pre><p>Now try the app in your browser and check that the country codes are still logged to the console when you click the button. If they are, your change works! If not, you can compare your current files to the ones here:</p>
<ul>
<li><a href="https://github.com/mikkokotola/populationgraphs/blob/994708304bc15f8cdb31bf0d16ee7eef701ce127/public/index.html">index.html</a></li><li><a href="https://github.com/mikkokotola/populationgraphs/blob/994708304bc15f8cdb31bf0d16ee7eef701ce127/public/myChart.js">myChart.js</a></li></ul>
<p>So what did we just do? It&#39;s called <strong>refactoring</strong>. We changed the structure of the code without changing how the code works. We moved the Javascript code from within the <em>&lt;/script&gt;</em> tags to a separate Javascript file (with a file ending .js) and added one line in the head of the <em>index.html</em> to load those scripts from the separate file. </p>
<p>The attributes of the loading line are important. The first one it <em>defer</em>. This tells the browser to wait for the HTML structure to load before running the script file. If we did not have this, the browser would try to look for the button to attach an event handler to, but would not find any button, because it would not have been created yet. The second attribute is <em>src=&#39;./myChart.js&#39;</em>. This just tells where the script to load is located (the <em>src</em> is short for <em>source</em>). The <em>./</em> part means to look in the same folder as where the <em>index.html</em> is located.</p>
<p>Great, now we can write new scripts in the file <em>myChart.js</em> and they will always be loaded when we reload the index.html in our browser!</p>
<h2 id="fetching-data">Fetching data</h2>
<p>Let&#39;s move to the second part of the walking skeleton: fetching the population time series for a country. For this, we&#39;ll be working inside the file <em>myChart.js</em>.</p>
<p>We already know where to get the World Bank data. The example URL that we looked at before was <a href="https://api.worldbank.org/v2/country/FIN/indicator/SP.POP.TOTL?format=json">https://api.worldbank.org/v2/country/FIN/indicator/SP.POP.TOTL?format=json</a>. And we also found out that the two important parts of the URL were <em>FIN</em> (the three-letter code for Finland), where we select the country, and <em>SP.POP.TOTL</em> (the indicator code for total population count), where we select the indicator that we want to data for. In this workshop, we will only be using the indicator <em>SP.POP.TOTL</em> but will be changing the country.</p>
<p>So, let&#39;s insert the following function code into the bottom of the file <em>myChart.js</em>:</p>
<pre><code>async function fetchData() {
    var countryCode = document.getElementById(&#39;country&#39;).value;
    const indicatorCode = &#39;SP.POP.TOTL&#39;;  
    const baseUrl = &#39;https://api.worldbank.org/v2/country/&#39;;
    const url = baseUrl + countryCode + &#39;/indicator/&#39; + indicatorCode + &#39;?format=json&#39;;
    console.log(&#39;Fetching data from URL: &#39; + url);

    var response = await fetch(url);

    if (response.status == 200) {
        var fetchedData = await response.json();
        console.log(fetchedData);
    }
}
</code></pre><p>And then modify the line, where we attach a callback function to the event listener (remember, this just tells the event listener which function to call when someone click the button). Change the <code>logCountryCode</code> on that line to <code>fetchData</code>.</p>
<p>Try it out by entering <em>FIN</em> and pressing the button.</p>
<p>You should something new in you console. The first line is understandable. It says &#39;Fetching data from &#39; and then shows the same URL we&#39;ve already seen. But the second line looks a bit more weird.</p>
<p><img src="WebCodingForBeginners.html_files\images\console_array.png" alt="Array in console"></p>
<p>At least it says Array(50). And there&#39;s a small black triangle on the left side of it. Click the triangle. And click the triangles next to the 0 and 1 that appeared. And then again the 0 and 1 under the higher-level 1. You should see a view like this:</p>
<p><img src="WebCodingForBeginners.html_files\images\console_countrydata.png" alt="Data for Finland in console"></p>
<p>Hah! It appears we have the same data here that we looked at before. The first part (upper-level 0) is <strong>metadata</strong>, data describing the actual data that we requested. It tells us how many pages there are, how many data items are on a page, how many there are in total and when the data was last updated. The second part (upper-level 1) is the population time series. It is an <strong>array</strong>, which basically means a list of several items. The current array that we have appears to have 50 items in it. The first data item (the 0 under the upper-level 1) has the population count for the year 2019. Wait a minute, no it doesn&#39;t. The value says <em>null</em>. Looks like World Bank hasn&#39;t got the figures for last year yet. The next item, year 2018, looks better. Finland&#39;s population was 5 518 050 in the year 2018. And the following items look good.</p>
<p>So what did the new code do? Well, our new function fetchData does what it promises, fetches data. The first line we already know: it gets the current value of the text input field (found by using the id &#39;country&#39;) and saves it in a variable called <em>countryCode</em>. The next line is similar but simpler. We just create a new variable called <em>indicatorCode</em> and assign the value &#39;SP.POP.TOTL&#39; to it. Except there&#39;s the keyword <em>const</em> instead of <em>var</em>. <em>Const</em> is short for <em>constant variable</em> (whereas <em>var</em> is short for variable). Constant just means we set the value once and it never changes. The next line is the same. We create a constant called <em>baseUrl</em> and assign the first part of the World Bank API URL to it. The fourth line creates another constant called <em>url</em>, where it concatenates (puts one after another) the needed pieces of text (technically called <strong>strings</strong>): the baseUrl, the countryCode, then the text <code>/indicator/</code>, then the indicatorCode and finally <code>?format=json</code>. If we enter the letters FIN, the constant <em>url</em> will be exactly the same as the sample URL we have looked at, <a href="https://api.worldbank.org/v2/country/FIN/indicator/SP.POP.TOTL?format=json">https://api.worldbank.org/v2/country/FIN/indicator/SP.POP.TOTL?format=json</a>. We can confirm this also in the console, because on the fifth line we log the value of that constant. Using <code>console.log()</code> is often a very good idea when developing new Javascript code. And it&#39;s not just beginners: it&#39;s popular also amongst seasoned developers. It&#39;s simple and it just works.</p>
<p>The sixth line of code is the most important one in this function:</p>
<pre><code>var response = await fetch(url);
</code></pre><p>The first part is familiar. We are again creating a variable called <em>response</em>. But what are we assigning into it? The core here is <code>fetch(url)</code>. <strong>Fetch</strong> is a built-in tool for sending <strong>HTTP requests</strong>. HTTP is the protocol (defined way of exchanging messages) that is used for loading and sending data to websites. You have most likely heard of it, because your browser uses it when you are loading web pages or sending data by filling in forms on web pages. The HTTP protocol is also used many APIs, like the World Bank API. That&#39;s why we could so easily request data using our browsers.</p>
<p>So we give our url to <em>fetch</em> and it sends an HTTP request to that URL. Thanks to the keyword <em>await</em> on the row, the browser waits for the HTTP response from the World Bank servers and then assigns the HTTP response to our variable <em>response</em>. The <em>await</em> has to be there because it takes some time for the request to be transferred over the internet to the World Bank servers (which might be in e.g. USA), the servers to create the response and for the response to be transferred over the internet back to the computer the browser is running on. This type of operation, one that we have to wait for the response to, is called <strong>asynchronous</strong>. And that&#39;s why we have the <em>async</em> keyword in front of our function definition: it&#39;s defining that this function contains asynchronous parts and will not finish immediately.</p>
<p>So after that line (and a bit of time, maybe about 0,8 seconds), we have an HTTP response in the variable <em>response</em>. In the next line, we are checking if the status code of the response is 200. 200 means everything went fine and the request was successful and we should have the data we requested in the response. If the status code is 200, the two lines inside the if-block will be executed. If the status was something else, those lines will not be executed and nothing more will happen.</p>
<p>If the code is 200, then the first line converts the body of the HTTP response to JSON format (the format that we saw before in our browser and also in our console) and saves that data into the variable <em>fetchedData</em>. The second line logs that data into the console. So that&#39;s how it ended up there for us to look at.</p>
<p>Now that was a tad complicated. If you did not understand everything, don&#39;t worry. On the other hand, if you are really keen on learning more about this part, please open the <em>Network</em> tab on your browser&#39;s developer tools and investigate a bit more what happens when you run your app (and possibly grab an instructor by the sleeve). You can also read more about <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">HTTP status codes</a> if you&#39;re interested. But for the current task, this level of understanding is more than sufficient.</p>
<p>Looks like we have two out of three down on our walking skeleton list!:</p>
<ul>
<li>Possibility for the user to input a country - DONE</li><li>Fetching the population time series for that country - DONE</li><li>Showing the population graph</li></ul>
<h2 id="visualizing-data">Visualizing data</h2>
<p>Our skeleton is starting only missing it&#39;s legs. Let&#39;s attack the last part: visualizing the population time series.</p>
<p>Here&#39;s some good news: visualizing data is very common in web applications, so it has been done before. And because coders like to reuse their previous work, people have built ready-to-use high-level tools for creating charts and graphs. And many of them are free to use and <strong>open-source</strong> (meaning the source code is available publicly for anyone to read and to contribute to). We are going to do our visualizations using <a href="https://www.chartjs.org/">Chart.js</a>.</p>
<p>We will need two additions to <em>index.html</em>. First, add the following code the head section (before the myChart.js script line):</p>
<pre><code>    &lt;script defer src=&#39;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js&#39;&gt;&lt;/script&gt;
</code></pre><p>This code will load the code for Chart.js into the browser from their hosting site. So we&#39;re loading the tool needed for creating the visualization. Notice that this line is very similar to loading our own script.</p>
<p>Second, we need to add an HTML element where we can render the population graph. Graph.js requires a <em>canvas</em> element that can be used for drawing 2-dimensional graphics and animations. Add it by inserting this line at the end of the body:</p>
<pre><code>    &lt;canvas id=&#39;myChart&#39;&gt;&lt;/canvas&gt;
</code></pre><p>Let&#39;s move to the file <em>myChart.js</em>. Add the following two helper functions to the end of the file:</p>
<pre><code>function getValues(data) {
    var vals = data[1].sort((a, b) =&gt; a.date - b.date).map(item =&gt; item.value);
    return vals;
}

function getLabels(data) {
    var labels = data[1].sort((a, b) =&gt; a.date - b.date).map(item =&gt; item.date);
    return labels;
}
</code></pre><p>These helper functions will extract the actual population counts and the year labels from the data array that we got from the World Bank (and that we printed in the console). Remember how it had a lot of extra data that we won&#39;t need for the population graph. These methods will provide us with just the data we need. They are not being called yet, so they won&#39;t do anything yet.</p>
<p>Then we&#39;ll see how our new tool works. Let&#39;s add this function that will render the actual population graph using the population data and the year labels:</p>
<pre><code>function renderChart(data, labels) {
    var ctx = document.getElementById(&#39;myChart&#39;).getContext(&#39;2d&#39;);

    // Draw new chart
    new Chart(ctx, {
        type: &#39;line&#39;,
        data: {
            labels: labels,
            datasets: [{
                label: &#39;Population&#39;,
                data: data,
                borderColor: &#39;rgba(75, 192, 192, 1)&#39;,
                backgroundColor: &#39;rgba(75, 192, 192, 0.2)&#39;,
            }]
        }
    });
}
</code></pre><p>The first row looks quite similar to what we&#39;ve already seen. It finds an HTML element using the id <em>myChart</em>. It then gets the 2d-context of that element (the canvas) and saves it to the variable <em>ctx</em>. You can think of this context as a 2-dimensional whiteboard that we can use for drawing. </p>
<p>The rest of the code consists of a call <code>new Chart(ctx, {...})</code>. This is where we are telling the Chart.js tool &#39;Draw a new Chart ON this 2-d whiteboard (<em>ctx</em>) using this data and these labels&#39;. The <code>type: &#39;line&#39;</code> sets the type of chart as a line chart. The <em>label</em> defines a label for the line. The <code>borderColor: &#39;rgba(75, 192, 192, 1)&#39;</code> defines what colour we want the line to be. It is defined using values for red, green, blue and alpha (for transparency). The <em>backgroundColor</em> does the same for the fill colour of the chart.</p>
<p>We&#39;ve got all the pieces now. Let&#39;s put them together by modifying the if-block within the fetchData() function. Add the three lines below at the end of the if-block. The whole if-block will then look like this:</p>
<pre><code>     if (response.status == 200) {
        var fetchedData = await response.json();
        console.log(fetchedData);

        var data = getValues(fetchedData);
        var labels = getLabels(fetchedData);
        renderChart(data, labels);
    }
</code></pre><p>The three new lines will call the functions we defined above. The first line extracts the actual population data values from the fetchedData object. The second line extracts the labels. And the third line gives the data and the labels to the function renderChart asking it to draw the chart.</p>
<p>Time to try it out in the browser!</p>
<p>Woohoo! We have liftoff! With the country code FIN, it should look like this:</p>
<p><img src="WebCodingForBeginners.html_files\images\first_graph.png" alt="First population graph, Finland"></p>
<p><strong>The skeleton is walking!</strong> Try with some different country codes. Celebrate! Have a cup of coffee, you&#39;ve earned it! </p>
<p>If this is all you have time for, you can be proud. You have just built a working web app! You are running it locally, but it could easily be put to a hosting service, available for anyone to use.</p>
<p>If you still have time, there are still several things we can do to improve the app.</p>
<h2 id="clean-up">Clean-up</h2>
<p>Time to do some clean-up. We are no longer using the function logCountryCode so remove it from the js file. Remove also the comment before the event listener line. So the first line of the file will be <code>document.getElementById(&#39;renderBtn&#39;).addEventListener(&#39;click&#39;, fetchData);</code> after the clean-up.</p>
<p>Cleaning up dead code is important. If you don&#39;t, your files will become cluttered with unused code and it will be hard to figure out what is actually being used and what is not. Keep it clean.</p>
<h2 id="bug-hunting">Bug-hunting</h2>
<p>At this point you might have noticed that there is a bug in our app. Can you find it? When does it occur? Do you have ideas on what might be causing it? Try to find it and think about it a bit before continuing. Or talk to a friend or instructor if you can&#39;t find it.</p>
<p>How could we fix the bug? The root cause is that we are not cleaning up our whiteboard in between drawing different population graphs. So there are several there, although only one at a time is displayed. Let&#39;s fix the bug by saving a reference to a chart when we draw it, and then wiping the previous chart away before drawing a new one. You can accomplish this by</p>
<ul>
<li>Defining a variable <code>var currentChart;</code> <em>outside</em> all functions. A variable like this is global and can be accessed by all functions. So put it at the very top of the js file.</li><li>Saving the reference to the chart to that variable when a new chart is created. So <code>currentChart = new Chart(...</code></li><li>Destroying the old chart (if it exists) before drawing a new one. So just before the <code>currentChart = new Chart(...</code> add <pre><code>  if (currentChart) {
      // Clear the previous chart if it exists
      currentChart.destroy();
  }
</code></pre></li></ul>
<p>There is (sort of) also another problem. Even though the population graph looks visually nice, the population changes always look quite dramatic. That is because by default, Chart.js does not start the y-axis at zero. It would be more truthful to start the y-axis at zero. Let&#39;s add the needed parameters to the <code>new Chart(...)</code> definition. The new part is the <em>options</em> part. </p>
<pre><code>    currentChart = new Chart(ctx, {
        type: &#39;line&#39;,
        data: {
            labels: labels,
            datasets: [{
                label: &#39;Population&#39;,
                data: data,
                borderColor: &#39;rgba(75, 192, 192, 1)&#39;,
                backgroundColor: &#39;rgba(75, 192, 192, 0.2)&#39;,
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</code></pre><p>Much better.</p>
<h2 id="make-it-look-nice">Make it look nice</h2>
<p>Let&#39;s face it. The skeleton walks but the bones are still showing. We have to make it a bit nicer before showing it to any users (and before we can call it an MVP).</p>
<p>We will make it nicer by using the third central technology of web apps, CSS. </p>
<p>As before, let&#39;s do a quick improvement by using a ready stylesheet that someone has build for us. In this case originally Twitter. We&#39;ll load the Bootstrap stylesheet by adding the following line to the header of our <em>index.html</em>. A good place for it is before the <em>script</em> lines in the header.</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot; integrity=&quot;sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm&quot; crossorigin=&quot;anonymous&quot;&gt;
</code></pre><p>Notice how it looks a bit similar to how we loaded the scripts. It says it&#39;s a stylesheet and points to an address that the stylesheet can be loaded from. The integrity marking makes sure that we get the stylesheet that we are supposed to (that it hasn&#39;t been corrupted in transfer or tampered with by a 3rd party). </p>
<p>Once you have added this, check out how it changes the look of the page. Much better already! </p>
<p>Maybe it would look better if we centered all content. For this, let&#39;s do two things. First, wrap everything in the body of the <em>index.html</em> into a div: <code>&lt;div class=&#39;content&#39;&gt;...some lines...&lt;/div&gt;</code>. This trick will make it easier to center everything. Second, create a new file called styles.css (select CSS as the file type in Visual Studio Code when saving it). Now add the following style definition in the css file:</p>
<pre><code>.content {
    text-align: center;
}
</code></pre><p>To take our own stylesheet into use, we have to import it like we did with the Bootstrap stylesheet. Place our own stylesheet link <em>after</em> the Bootstrap link. The order matters because in CSS, the latter style definitions will in some cases overwrite those defined earlier. </p>
<pre><code>    &lt;link rel=&quot;stylesheet&quot; href=&quot;./styles.css&quot;&gt;
</code></pre><p>It looks much better now! The population graph is maybe a bit large. Let&#39;s limit the max size of the canvas. Do similar steps for the canvas: first wrap the canvas element in a <code>&lt;div class=&#39;container&#39;&gt;...&lt;/div&gt;</code> and then add a CSS definition for the class <em>container</em> that sets the width of the container to 75% of the width of the whole browser window: <code>width: 75vw;</code>.</p>
<p>Looking good now! Seems like we have an MVP!</p>
<h2 id="wrap-up">Wrap-up</h2>
<p>What have we done? Short answer: we&#39;ve built a working <strong>front-end</strong> application. Front-end refers to code that is executed in the user&#39;s browser: the HTML, CSS and Javascript. The front-end communicates with a <strong>back-end</strong>, which means servers where the application data is stored (usually in databases of some kind). In our application&#39;s case the back-end was offered by the World Bank; we did not have to build a separate back-end for our app since we did not need e.g. authentication of the users or save any data about the users. The World Bank had done a lot of work collecting and proprocessing the data, has it stored in databases and offers it to us through a web API. Thank you World Bank! Very often the front-end communicates with the back-end using HTTP requests, just like our front-end does.</p>
<p>In this workshop, you have learned to work with the essential technologies of current web applications: HTML, CSS and Javascript. You have got your hands on some real World Bank data and used some tools offered to us by the web community: the visualization library Chart.js and the Bootstrap stylesheet. You have build a working web app. How was this possible? One notable factor making this possible is <strong>openness</strong>. We used open data from World Bank, open source code (the app itself and the mentioned tools) and worked using the open internet. Another view into the app is that we composed it by using several quite high-level pieces. This is in fact how many of the applications and services are born: the starting point is a customer need or an idea for a new service, and the application is built to realized that idea by using many different data sources and ready software components. There is not necessarily that much own code, and the code that is there is mainly tying together the different components to produce something new, something unique.</p>
<p>So hopefully you have enjoyed the journey and have some new skills and insights to take home!</p>
<h2 id="feedback">Feedback</h2>
<p>We would love to get some feedback from you. Regardless of whether you have worked on this material in an instructed workshop or by yourself. Feedback helps us recognize what is working and which parts we should still improve for the future.</p>
<p>Give feedback at (link to be added). </p>
<h2 id="extra-assignments">Extra assignments</h2>
<p>If you are still eager to learn more and improve you app (outside the workshop), here are some assignments to improve the app or and code.</p>
<h3 id="small-assignments">Small assignments</h3>
<ul>
<li>Customize the look of the graph by adjusting the Chart.js parameters. For colours, see e.g. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Colors/Color_picker_tool">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Colors/Color_picker_tool</a></li><li>Customize the look of the page by altering the CSS. Try e.g. changing the font or font size or padding of elements. Or substitute the Bootstrap for another style sheet like <a href="https://materializecss.com/getting-started.html">Materialize</a>.</li><li>Change indicator that the app fetches. So instead of the country&#39;s total population, fetch e.g. SP.POP.65UP.FE.IN or SP.DYN.LE00.MA.IN. The different age segments for the SP.POP are 0014 (0-14), 1564 (15-64) and 65UP (65-). The gender codes are FE (female) and MA (male). You can also google the World Bank API and try look for other interesting indicators that are offered as time series. </li></ul>
<h3 id="medium-size-assignments">Medium-size assignments</h3>
<ul>
<li>Fetch information about the capital city and area of the country + the country flag image from <a href="https://restcountries.eu/#api-endpoints-code">RESTCountries API</a> and display those along with the population graph. You will need to create new HTML elements and make a similar API request to RestCountries as you did to the World Bank API. For a point of comparison, you can look at the master branch of the <a href="https://github.com/mikkokotola/populationgraphs">Population graphs repository</a>.</li><li>Our app does not really have error handling. Implement error handling for cases when the user inputs an incorrect country code or when fetching the data fails (due to e.fg. unavailable internet connection). You should probably use a try-catch block and add HTML elements for displaying errors. Again, for point of comparison look at the master branch of the repo.</li></ul>
<h3 id="large-assignments">Large assignments</h3>
<ul>
<li>Implement way for the user to select the country using a drop-down menu instead of typing in a country code. You can fetch the list of countries from a World Bank API at address <a href="https://api.worldbank.org/v2/country?format=json&amp;per_page=400">https://api.worldbank.org/v2/country?format=json&amp;per_page=400</a>. For comparison, look at the branch [dropdowncountryselection].(<a href="https://github.com/mikkokotola/populationgraphs/tree/dropdowncountryselection">https://github.com/mikkokotola/populationgraphs/tree/dropdowncountryselection</a>) of the repository.</li><li>Implement functionality to select the age segment to display (see the age segments under Small assignments).</li></ul>
<h2 id="technical">Technical</h2>
<p>Author: Mikko Kotola 2020<br>License: MIT
Made using markdown and Abricotine editor<br>World Bank data license: CC-BY-4.0</p>

        </article>
    </body>
</html>
